<div class="choice"
     [ngClass]="{noTitle: !get('Title')}"
     title="{{(!get('Description') ? get('Title') : '')}}">
  @if (get('Title')) {
  <span title="{{(!get('Description') ? '' : get('Title'))}}">{{get('Title')}}</span>
  }

  @if (get('Description')) {
  <i (mouseenter)="showHideTooltip(true)"
     (mouseleave)="showHideTooltip(false)">(i)</i>
  <div class="ToolTip"
       [hidden]="!tooltip">{{get('Description')}}</div>
  }

  @if (get('Required')) {
  <span class="Required">*</span>
  }

  <div>
    @switch (get('TypeAsString')) {
    @case ('Boolean') {
    <label>
      <input style="width: auto; height: auto;"
             [disabled]="disabled"
             type="checkbox"
             [(ngModel)]="form[field]"
             [required]="required()"
             name="{{prefix ?? ''}}{{field}}"
             (change)="changed()">
    </label>
    }
    @case ('MultiChoice') {
    @if (!disabled) {
    <input placeholder="Filter or search {{get('Title') || friendlyName(get('InternalName'))}} below"
           name="{{prefix ?? ''}}{{field}}_Search"
           [(ngModel)]="filterMulti"><br>
    }
    <select (mousedown)="false"
            (click)="changedM($event)"
            multiple="multiple"
            class="{{multiLargeorSmall()}}"
            [disabled]="disabled"
            [ngModel]="form[field].results"
            [required]="required()"
            name="{{prefix ?? ''}}{{field}}">
      @for (i of choices(); track $index) {
      <option [value]="i">{{i}}</option>
      }
    </select>
    }
    @case ('Choice') {
    @if (get('Format') != 'RadioButtons') {
    <select [disabled]="disabled"
            (ngModelChange)="selChangeS($event)"
            [ngModel]="form[field]"
            [required]="required()"
            name="{{prefix ?? ''}}{{field}}"
            [style.width.%]="!inChoices() ? 50 : 100"
            [hidden]="disabled && !inChoices()">
      <option disabled
              selected
              hidden>Please select {{get('Title') || friendlyName(get('InternalName'))}}</option>
      @if (select?.none) {
      <option [value]="null">{{select?.none}}</option>
      }
      @for (i of choices(); track $index) {
      <option [value]="i">{{i}}</option>
      }
      @if (select?.other || get('FillInChoice')) {
      <option [value]="inChoices() ? 'Please select...' : form[field]">{{select?.other || 'Other'}}, please specify...</option>
      }
    </select>
    <input [disabled]="disabled"
           type="text"
           [(ngModel)]="form[field]"
           [required]="required()"
           name="{{prefix ?? ''}}{{field}}_Other"
           [style.width.%]="!disabled || inChoices() ? 50 : 100"
           maxlength="250"
           (click)="$event.target.select()"
           (change)="changed()"
           [hidden]="inChoices()">
    }
    @else {
    @if (select?.none) {
    <label class="radio">
      <input [value]="null"
             [disabled]="disabled"
             type="radio"
             [(ngModel)]="form[field]"
             [required]="required()"
             name="{{prefix ?? ''}}{{field}}"
             (change)="changed()">
      {{select?.none}}
    </label>
    }
    @for (i of choices(); track $index) {
    <label class="radio">
      <input [value]="i"
             [disabled]="disabled"
             type="radio"
             [(ngModel)]="form[field]"
             [required]="required()"
             name="{{prefix ?? ''}}{{field}}"
             (change)="changed()">
      {{i}}
    </label>
    }
    <input style="display:none !important;"
           type="text"
           [required]="required()"
           [value]="validator()"
           name="{{prefix ?? ''}}{{field}}_Validator">
    }
    }
    @case ('Integer') {
    <input [disabled]="disabled"
           type="number"
           [(ngModel)]="form[field]"
           [required]="required()"
           name="{{prefix ?? ''}}{{field}}"
           [min]="get('Min')"
           [max]="get('Max')"
           (change)="changed()"
           placeholder="{{get('Title') || friendlyName(get('InternalName'))}}...">
    }
    @case ('Number') {
    <input [disabled]="disabled"
           type="text"
           pattern="-{0,1}[0-9,]*\.{0,1}[0-9,]*"
           [ngModel]="niceNumber()"
           (ngModelChange)="numberSet($event)"
           [required]="required()"
           name="{{prefix ?? ''}}{{field}}"
           [min]="get('Min')"
           [max]="get('Max')"
           (change)="changed()"
           placeholder="{{get('Title') || friendlyName(get('InternalName'))}}...">
    }
    @case ('DateTime') {
    @if (get('DisplayFormat') != 1) {
    <input [disabled]="disabled"
           type="date"
           [ngModel]="form[field] | date:'yyyy-MM-dd'"
           (ngModelChange)="dateSet($event)"
           [required]="required()"
           name="{{prefix ?? ''}}{{field}}"
           (change)="changed()"
           [min]="get('Min')"
           [max]="get('Max')"
           placeholder="{{get('Title') || friendlyName(get('InternalName'))}}...">
    }
    @else {
    <input [disabled]="disabled"
           type="datetime-local"
           [ngModel]="form[field] | date:'yyyy-MM-ddTHH:mm'"
           (ngModelChange)="dateSet($event)"
           [required]="required()"
           name="{{prefix ?? ''}}{{field}}"
           (change)="changed()"
           [min]="get('Min')"
           [max]="get('Max')"
           placeholder="{{get('Title') || friendlyName(get('InternalName'))}}...">
    }
    }
    @case ('Text') {
    <input [disabled]="disabled"
           type="text"
           [pattern]="text?.pattern || '.*'"
           [(ngModel)]="form[field]"
           [required]="required()"
           name="{{prefix ?? ''}}{{field}}"
           [maxlength]="get('MaxLength')"
           (change)="changed()"
           (keyup)="onUpText($event.key)"
           (click)="onUpText(undefined)"
           placeholder="{{get('Title') || friendlyName(get('InternalName'))}}...">
    <div class="MaxLength"
         [hidden]="remaining(255) >= 5">Maximum {{remaining(255)}} characters remaining</div>

    @if (!disabled && results.length > 0) {
    <div style="position: relative; padding: 0;">
      <div class="AutoComplete">
        <ul>
          @for (result of results; track $index; let i = $index) {
          <li (click)="selectedText(result)"
              [hidden]="result['hide']"
              [style]="(pos == i ? 'background-color: rgba(0, 0, 0, 0.04);' : '')">
            {{result[field]}}
          </li>
          }
          <li style="text-align: right;"
              (click)="selectedText(null)">
            Cancel
          </li>
        </ul>
      </div>
    </div>
    }
    }
    @case ('Note') {
    @if (!disabled) {
    @if (!get('RichText')) {
    @if (!get('AppendOnly')) {
    <textarea [(ngModel)]="form[field]"
              [required]="required()"
              name="{{prefix ?? ''}}{{field}}"
              (change)="changed()"
              [style]="(text?.height ? 'height: '+text?.height+'px' : '')"
              placeholder="{{get('Title') || friendlyName(get('InternalName'))}}..."></textarea>
    }
    @else {
    <textarea [required]="required()"
              name="{{prefix ?? ''}}{{field}}"
              (change)="changedA($event)"
              [style]="(text?.height ? 'height: '+text?.height+'px' : '')"
              placeholder="{{get('Title') || friendlyName(get('InternalName'))}}..."></textarea>
    }
    }
    @else if (editor) {
    <div class="NgxEditor__Wrapper">
      <ngx-editor-menu [editor]="editor"
                       [toolbar]="toolbar"></ngx-editor-menu>
      @if (!get('AppendOnly')) {
      <ngx-editor [editor]="editor"
                  [(ngModel)]="form[field]"
                  placeholder="{{get('Title') || friendlyName(get('InternalName'))}}..."
                  (ngModelChange)="changed()"
                  name="{{prefix ?? ''}}{{field}}"
                  [required]="required()"
                  [outputFormat]="'html'">
      </ngx-editor>
      }
      @else {
      <ngx-editor [editor]="editor"
                  [(ngModel)]="unused"
                  placeholder="{{get('Title') || friendlyName(get('InternalName'))}}..."
                  (ngModelChange)="changedA($event)"
                  name="{{prefix ?? ''}}{{field}}"
                  [required]="required()"
                  [outputFormat]="'html'">
      </ngx-editor>
      }
    </div>
    }
    <div class="MaxLength"
         [hidden]="remaining() >= 15">Maximum {{remaining()}} characters remaining</div>
    }
    @else {
    @if (!get('RichText')) {
    <div style="max-height: 500px; overflow: auto;">{{form[field]}}</div>
    }
    @else {
    <div style="max-height: 500px; overflow: auto;"
         [innerHTML]="form[field]"></div>
    }
    }
    }
    @case ('URL') {
    <input [disabled]="disabled"
           [(ngModel)]="form[field].Url"
           [required]="required()"
           name="{{prefix ?? ''}}{{field}}_Url"
           placeholder="https://"
           pattern="^.+\:\/\/.+$|^mailto\:.+$"
           (change)="changed()"
           style="width:50%">
    <input [disabled]="disabled"
           [(ngModel)]="form[field].Description"
           name="{{prefix ?? ''}}{{field}}_Desc"
           maxlength="250"
           (change)="changed()"
           style="width:50%">
    }
    @case ('Attachments') {
    @if (!file?.uploadonly) {
    @if (attachments().length > 0) {
    <div [hidden]="!file?.doctype || !hasChecked()">
      Update selected:
      <select (change)="setClasses($event)"
              name="{{prefix ?? ''}}{{field}}_Cat">
        <option disabled
                selected
                hidden>{{file?.doctype}}</option>
        @for (v of file?.doctypes; track $index) {
        <option value="{{v}}">{{v}}</option>
        }
      </select>
    </div>

    <table class="files desktop"
           (dragover)="over($event)"
           (dragleave)="leave($event)"
           (drop)="drop($event)"
           [ngClass]="{'FilesOver': filesOver}">
      <tr>
        <th [hidden]="!file?.check"></th>
        @if (field != 'Attachments' && file?.doctype) {
        <th style="width: 0; white-space: nowrap;">
          <span style="cursor: pointer;"
                (click)="changeSort(file?.doctype)">
            File Type
          </span>
          <select style="width:30px;border:none;margin-left:8px;"
                  [(ngModel)]="filter"
                  name="{{prefix ?? ''}}{{field}}_Filter">
            <option value>All</option>

            @for (v of usedTypes(); track $index) {
            <option value="{{v}}">{{v}}</option>
            }
          </select>
          <span [hidden]="sort != '+'+file?.doctype">&#9660;</span>
          <span [hidden]="sort != '-'+file?.doctype">&#9650;</span>
        </th>
        }
        <th>
          <span style="cursor: pointer;"
                (click)="changeSort('Title')">
            File Name
          </span>
          <span [hidden]="sort != '+Title'">&#9660;</span>
          <span [hidden]="sort != '-Title'">&#9650;</span>
        </th>
        @if (field != 'Attachments' && file?.notes) {
        <th>
          <span>
            {{friendlyName(file?.notes)}}
          </span>
        </th>
        }
        @for (k of additionalKeys(file?.spec); track $index) {
        <th>
          <span>
            {{file?.spec?.[k]?.Title || friendlyName(file?.spec?.[k]?.InternalName)}}
          </span>
        </th>
        }
        @if (field != 'Attachments') {
        <th style="width: 0; white-space: nowrap;">
          <span style="cursor: pointer;"
                (click)="changeSort('Created')">
            Date Uploaded
          </span>
          <span [hidden]="sort != '+Created'">&#9660;</span>
          <span [hidden]="sort != '-Created'">&#9650;</span>
        </th>
        }
        @else {
        <th style="width: 0;"></th>
        }
      </tr>
      @for (f of attachments(); track $index; let i = $index) {
      <tr>
        <td [hidden]="!file?.check">
          <input type="checkbox"
                 [disabled]="disabled || f.Deleted || (field != 'Attachments' && file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) || f.ServerRelativeUrl?.length > 402"
                 [(ngModel)]="f.Checked"
                 name="{{prefix ?? ''}}{{field}}_Checked_{{i}}">
        </td>
        @if (field != 'Attachments' && file?.doctype) {
        <td style="white-space: nowrap"
            [style]="width()">
          <app-choice [form]="f.ListItemAllFields"
                      [spec]="loadOrGenerateSpec(file?.doctype, 'Choice')"
                      [field]="file?.doctype || 'DocType'"
                      [prefix]="field+'_'+i"
                      (change)="changed()"
                      [disabled]="disabled || f.Deleted || (file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) || f.ServerRelativeUrl?.length > 402">
          </app-choice>
        </td>
        }
        @if (f.Deleted) {
        <td>
          <span style="color: red; text-decoration: line-through">{{f.ListItemAllFields?.Title || f.FileName}}</span>

          <a style="color: green; padding-left: 8px;cursor: pointer;"
             (click)="delete(f, false)"
             title="Undelete"
             [hidden]="disabled || f.ServerRelativeUrl?.length > 402">+</a>
        </td>
        }
        @else if (field != 'Attachments' && file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) {
        <td>
          <span style="text-decoration: line-through">{{f.ListItemAllFields?.Title || f.FileName}}</span>

          <a style="color: green; padding-left: 8px;cursor: pointer;"
             (click)="delete(f, false)"
             title="Undelete"
             [hidden]="disabled || f.ServerRelativeUrl?.length > 402">+</a>
          <a style="color: red; padding-left: 8px;cursor: pointer;"
             (click)="delete(f, true)"
             title="Delete"
             [hidden]="disabled || f.ServerRelativeUrl?.length > 402">x</a>
        </td>
        }
        @else {
        <td style="position: relative">
          <a [hidden]="!f.ServerRelativeUrl || !file?.download"
             download="{{f.FileName}}"
             href="{{f.ServerRelativeUrl}}">{{f.ListItemAllFields?.Title || f.FileName}}</a>
          <a [hidden]="!f.ServerRelativeUrl || file?.download"
             (click)="newTab(f, $event)"
             style="cursor:pointer">{{f.ListItemAllFields?.Title || f.FileName}}</a>

          @if (field == 'Attachments') {
          <a [hidden]="f.ServerRelativeUrl">{{f.FileName}}</a>
          }
          @else if (f.ListItemAllFields) {
          <input [disabled]="disabled"
                 [hidden]="f.ServerRelativeUrl"
                 [(ngModel)]="f.ListItemAllFields.Title"
                 (change)="changed()"
                 style="width: calc( 100% - 38px );"
                 name="{{prefix ?? ''}}{{field}}_Name_{{i}}"
                 [title]="f.FileName + ' - ' + f.Length">
          }

          <a style="color: red; padding-left: 8px;cursor: pointer;position: absolute;"
             (click)="delete(f, true)"
             title="Delete"
             [hidden]="disabled || f.ServerRelativeUrl?.length > 402">x</a>
        </td>
        }
        @if (field != 'Attachments' && file?.notes) {
        <td>
          <app-choice [form]="f.ListItemAllFields"
                      [spec]="loadOrGenerateSpec(file?.notes)"
                      [field]="file?.notes || 'Notes'"
                      [prefix]="field+'_'+i"
                      (change)="changed()"
                      [disabled]="disabled || f.Deleted || (file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) || f.ServerRelativeUrl?.length > 402">
          </app-choice>
        </td>
        }
        @for (k of additionalKeys(file?.spec); track $index) {
        <td>
          <app-choice [form]="f.ListItemAllFields"
                      [spec]="file?.spec || spec"
                      [field]="file?.spec?.[k]?.InternalName"
                      [prefix]="field+'_'+i"
                      [disabled]="disabled || f.Deleted || (file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) || f.ServerRelativeUrl?.length > 402"
                      [text]="{
                        height: 35
                      }"
                      (change)="changed()"
                      [override]='"{\"Title\":\"\"}"'>
          </app-choice>
        </td>
        }
        <td>
          {{!f.ServerRelativeUrl ? 'Awaiting save' : !f.TimeCreated ? '' : f.TimeCreated | date:'dd MMM yyyy HH:mm'}}
        </td>
      </tr>
      }
      <tr>
        <td colspan="99">Shown files: {{attachments().length}}</td>
      </tr>
    </table>

    <div class="files mobile"
         (dragover)="over($event)"
         (dragleave)="leave($event)"
         (drop)="drop($event)"
         [ngClass]="{'FilesOver': filesOver}">
      @for (f of attachments(); track $index; let i = $index) {
      <div>
        @if (f.Deleted) {
        <div>
          <span style="color: red; text-decoration: line-through">{{f.ListItemAllFields?.Title || f.FileName}}</span>

          <a style="color: green; padding-left: 8px;cursor: pointer;"
             (click)="delete(f, false)"
             title="Undelete"
             [hidden]="disabled || f.ServerRelativeUrl?.length > 402">+</a>
        </div>
        }
        @else if (field != 'Attachments' && file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) {
        <div>
          <span style="text-decoration: line-through">{{f.ListItemAllFields?.Title || f.FileName}}</span>

          <a style="color: green; padding-left: 8px;cursor: pointer;"
             (click)="delete(f, false)"
             title="Undelete"
             [hidden]="disabled || f.ServerRelativeUrl?.length > 402">+</a>
          <a style="color: red; padding-left: 8px;cursor: pointer;"
             (click)="delete(f, true)"
             title="Delete"
             [hidden]="disabled || f.ServerRelativeUrl?.length > 402">x</a>
        </div>
        }
        @else {
        <div style="position: relative;">
          <input [hidden]="!file?.check"
                 type="checkbox"
                 [disabled]="disabled || f.Deleted || (field != 'Attachments' && file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) || f.ServerRelativeUrl?.length > 402"
                 [(ngModel)]="f.Checked"
                 (change)="changed()"
                 name="{{prefix ?? ''}}{{field}}_Check_{{i}}">

          <a [hidden]="!f.ServerRelativeUrl || !file?.download"
             download="{{f.FileName}}"
             href="{{f.ServerRelativeUrl}}">{{f.ListItemAllFields?.Title || f.FileName}}</a>
          <a [hidden]="!f.ServerRelativeUrl || file?.download"
             (click)="newTab(f, $event)"
             style="cursor:pointer">{{f.ListItemAllFields?.Title || f.FileName}}</a>

          @if (field == 'Attachments') {
          <a [hidden]="f.ServerRelativeUrl">{{f.FileName}}</a>
          }
          @else if (f.ListItemAllFields) {
          <input [disabled]="disabled"
                 [hidden]="f.ServerRelativeUrl"
                 [(ngModel)]="f.ListItemAllFields.Title"
                 style="width: calc( 100% - 38px );"
                 name="{{prefix ?? ''}}{{field}}_Name_{{i}}"
                 (change)="changed()"
                 [title]="f.FileName + ' - ' + f.Length">
          }

          <a style="color: red; padding-left: 8px;cursor: pointer;position: absolute;"
             (click)="delete(f, true)"
             title="Delete"
             [hidden]="disabled || f.ServerRelativeUrl?.length > 402">x</a>
        </div>

        @if (field != 'Attachments' && file?.doctype) {
        <div class="choice">
          {{friendlyName(file?.doctype)}}

          <app-choice [form]="f.ListItemAllFields"
                      [spec]="loadOrGenerateSpec(file?.doctype, 'Choice')"
                      [field]="file?.doctype || 'DocType'"
                      [prefix]="field+'_'+i"
                      (change)="changed()"
                      [disabled]="disabled || f.Deleted || (file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) || f.ServerRelativeUrl?.length > 402">
          </app-choice>
        </div>
        }
        @if (field != 'Attachments' && file?.notes) {
        <div class="choice">
          {{friendlyName(file?.notes)}}

          <app-choice [form]="f.ListItemAllFields"
                      [spec]="loadOrGenerateSpec(file?.notes)"
                      [field]="file?.notes || 'Notes'"
                      [prefix]="field+'_'+i"
                      (change)="changed()"
                      [disabled]="disabled || f.Deleted || (file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) || f.ServerRelativeUrl?.length > 402">
          </app-choice>
        </div>
        }
        @for (k of additionalKeys(file?.spec); track $index) {
        <div>
          <app-choice [form]="f.ListItemAllFields"
                      [spec]="file?.spec || spec"
                      [field]="file?.spec?.[k]?.InternalName"
                      [prefix]="field+'_'+i"
                      (change)="changed()"
                      [disabled]="disabled || f.Deleted || (file?.archive && f.ListItemAllFields[(file?.archive || 'Archive')]) || f.ServerRelativeUrl?.length > 402"
                      [text]="{
                        height: 75
                      }">
          </app-choice>
        </div>
        }
        }
        <div>
          {{!f.ServerRelativeUrl ? 'Awaiting save' : !f.TimeCreated ? '' : f.TimeCreated | date:'dd MMM yyyy HH:mm'}}
        </div>
      </div>
      }
    </div>

    }
    @else {
    <div style="text-align: center; padding: 4px;"
         (dragover)="over($event)"
         (dragleave)="leave($event)"
         (drop)="drop($event)"
         [ngClass]="{'FilesOver': filesOver}">
      No attachments yet.
    </div>
    }
    }
    @if (!disabled) {
    <div style="text-align: center; padding: 4px;"
         (dragover)="over($event)"
         (dragleave)="leave($event)"
         (drop)="drop($event)"
         [ngClass]="{'FilesOver': filesOver}">
      <b style="font-size: 48px;">&#8613;</b><br>
      Drag and drop files here<br>
      or<br>

      @if (office.type) {
      <button (click)="importOutlook()"
              [disabled]="office.loading"
              [hidden]="office.type != 'Outlook'">Import selected email(s)</button>
      <button (click)="importOffice()"
              [disabled]="office.loading"
              [hidden]="office.type == 'Outlook'">Import open file</button>
      }

      <input #fileInput
             accept="{{file?.accept}}"
             type="file"
             style="display: none !important;"
             multiple
             (change)="add($event.target)"
             name="{{prefix ?? ''}}{{field}}" />
      <button (click)="fileInput.click()">Browse file</button>

      <input style="display:none !important;"
             type="text"
             [required]="required()"
             [value]="validator('Attachments')"
             name="{{prefix ?? ''}}{{field}}_Validator">
    </div>
    }
    }
    @case ('UserMulti') {
    <div class="people">
      @for (user of form[field + 'Id']?.results; track $index) {
      <span style="padding: 8px;">{{displayUser(user)}} <a (click)="removeUser(user)"
           style="color: red;"
           [hidden]="disabled">X</a></span>
      }
    </div>
    <input type="text"
           [(ngModel)]="name"
           name="{{prefix ?? ''}}{{field}}"
           (keyup)="onUpUser($event.key)"
           (click)="onUpUser(undefined)"
           [hidden]="disabled"
           placeholder="{{get('Title') || friendlyName(get('InternalName'))}}...">
    <input style="display:none !important;"
           type="text"
           [required]="required()"
           [value]="validator('UserMulti')"
           name="{{prefix ?? ''}}{{field}}_Validator">

    @if (!disabled && users.length > 0) {
    <div style="position: relative; padding: 0;">
      <div class="AutoComplete">
        <ul>
          @for (user of users; track $index; let i = $index) {
          <li (click)="selectedUser(user)"
              [style]="(pos == i ? 'background-color: rgba(0, 0, 0, 0.04);' : '')">
            {{user.DisplayText}}
          </li>
          }
        </ul>
        <ul>
          <li style="text-align: right;"
              (click)="selectedUser(null)">
            Cancel
          </li>
        </ul>
      </div>
    </div>
    }
    }
    @case ('User') {
    <div class="people">
      @if (form[field + 'Id']) {
      <span style="padding: 8px;">{{displayUser(form[field + 'Id'])}} <a (click)="removeUser(null)"
           style="color: red;"
           [hidden]="disabled">X</a></span>
      }
    </div>
    <input type="text"
           [(ngModel)]="name"
           name="{{prefix ?? ''}}{{field}}"
           (keyup)="onUpUser($event.key)"
           (click)="onUpUser(undefined)"
           [hidden]="disabled || form[field + 'Id']"
           placeholder="{{get('Title') || friendlyName(get('InternalName'))}}...">
    <input style="display:none !important;"
           type="text"
           [required]="required()"
           [value]="validator('User')"
           name="{{prefix ?? ''}}{{field}}_Validator">

    @if (!disabled && users.length > 0) {
    <div style="position: relative; padding: 0;">
      <div class="AutoComplete">
        <ul>
          @for (user of users; track $index; let i = $index) {
          <li (click)="selectedUser(user)"
              [style]="(pos == i ? 'background-color: rgba(0, 0, 0, 0.04);' : '')">
            {{user.DisplayText}}
          </li>
          }
        </ul>
        <ul>
          <li style="text-align: right;"
              (click)="selectedUser(null)">
            Cancel
          </li>
        </ul>
      </div>
    </div>
    }
    }
    @case (null) {
    <div class="spin"></div>
    }
    @default {
    {{form[field] && form[field].results ? form[field].results.join(', ') : form[field]}}
    <div style="opacity:0.85">Error,{{required() ? ' required' : ''}} field type '{{get('TypeAsString')}}' not yet editable...</div>
    }
    }
  </div>

  @if (versions && versions.length > 1) {
  <ul class="versions"
      [hidden]="!versionsDisplayed">
    <li><b>Field version history:</b></li>
    @for (v of versions; track $index; let i = $index) {
    @if (i == 0) {
    <li class="current">
      {{v[field] ?? 'blank'}} - {{v['Created'] | date:'dd MMM yyyy HH:mm:ss'}} {{v['Editor']['LookupValue']}}
    </li>
    } @else if (v[field] != versions[i-1][field] && (v[field] || v[field]?.toString().length > 0)) {
    <li>
      {{v[field] ?? 'blank'}} - {{v['Created'] | date:'dd MMM yyyy HH:mm:ss'}} {{v['Editor']['LookupValue']}} {{versionsToggle()}}
    </li>
    }
    }
  </ul>
  }
</div>
